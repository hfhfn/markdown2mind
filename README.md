# Markmap Service

ä¸€ä¸ªåŸºäº Express.js çš„æ€ç»´å¯¼å›¾ç”ŸæˆæœåŠ¡ï¼Œå¯ä»¥å°† Markdown æ–‡æœ¬è½¬æ¢ä¸ºäº¤äº’å¼çš„æ€ç»´å¯¼å›¾ HTML æ–‡ä»¶ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“ æ”¯æŒ Markdown æ–‡æœ¬è½¬æ€ç»´å¯¼å›¾
- ğŸ“ æ”¯æŒæ–‡ä»¶ä¸Šä¼ æ–¹å¼
- ğŸŒ ç”Ÿæˆç‹¬ç«‹çš„ HTML æ–‡ä»¶ï¼Œå¯ç¦»çº¿ä½¿ç”¨
- ğŸ¨ æ”¯æŒè¯­æ³•é«˜äº®å’Œå·¥å…·æ 
- ğŸ³ Docker å®¹å™¨åŒ–éƒ¨ç½²
- ğŸ”„ æ™ºèƒ½é™æ€èµ„æºç®¡ç†

## å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd markmap-service
```

2. å¯åŠ¨æœåŠ¡
```bash
docker-compose up --build
```

3. æœåŠ¡å°†åœ¨ç«¯å£ 3000 å¯åŠ¨

### æœ¬åœ°å¼€å‘

1. å®‰è£…ä¾èµ–
```bash
npm install
```

2. å‡†å¤‡é™æ€èµ„æºï¼ˆè§ä¸‹æ–¹è¯´æ˜ï¼‰

3. å¯åŠ¨æœåŠ¡
```bash
npm start
```

## API æ¥å£

### 1. JSON æ–¹å¼æäº¤

**POST** `/markmap/json`

**å‚æ•°è¯´æ˜ï¼š**
- `markdown`: Markdown æ–‡æœ¬å†…å®¹ï¼ˆå¿…éœ€ï¼‰
- `fileType`: è¾“å‡ºæ ¼å¼ï¼Œé»˜è®¤ "html"
- `offline`: æ˜¯å¦ä½¿ç”¨ç¦»çº¿æ¨¡å¼ï¼Œé»˜è®¤ `true`ï¼ˆå¯é€‰ï¼‰

```bash
# é»˜è®¤ç¦»çº¿æ¨¡å¼ï¼ˆæ¨èï¼‰- ç”Ÿæˆå®Œå…¨ç‹¬ç«‹çš„HTMLæ–‡ä»¶
curl -X POST http://localhost:3000/markmap/json \
  -H "Content-Type: application/json" \
  -d '{
    "markdown": "# æˆ‘çš„æ€ç»´å¯¼å›¾\n\n## ç¬¬ä¸€ç« èŠ‚\n- è¦ç‚¹1\n- è¦ç‚¹2\n\n## ç¬¬äºŒç« èŠ‚\n- åŠŸèƒ½A\n- åŠŸèƒ½B",
    "fileType": "html"
  }'

# æ˜¾å¼æ§åˆ¶æ¨¡å¼
curl -X POST http://localhost:3000/markmap/json \
  -H "Content-Type: application/json" \
  -d '{
    "markdown": "# æˆ‘çš„æ€ç»´å¯¼å›¾\n\n## ç¬¬ä¸€ç« èŠ‚\n- è¦ç‚¹1\n- è¦ç‚¹2\n\n## ç¬¬äºŒç« èŠ‚\n- åŠŸèƒ½A\n- åŠŸèƒ½B",
    "fileType": "html",
    "offline": false
  }'
```

### 2. æ–‡ä»¶ä¸Šä¼ æ–¹å¼

**POST** `/markmap/upload`

**å‚æ•°è¯´æ˜ï¼š**
- `markdownFile`: Markdown æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
- `fileType`: è¾“å‡ºæ ¼å¼ï¼Œé»˜è®¤ "html"
- `offline`: æ˜¯å¦ä½¿ç”¨ç¦»çº¿æ¨¡å¼ï¼Œé»˜è®¤ `true`ï¼ˆå¯é€‰ï¼‰

```bash
# é»˜è®¤ç¦»çº¿æ¨¡å¼
curl -X POST http://localhost:3000/markmap/upload \
  -F "markdownFile=@example.md" \
  -F "fileType=html"

# æŒ‡å®šä½¿ç”¨æœ¬åœ°èµ„æºæ¨¡å¼
curl -X POST http://localhost:3000/markmap/upload \
  -F "markdownFile=@example.md" \
  -F "fileType=html" \
  -F "offline=false"
```

## ç”Ÿæˆæ¨¡å¼è¯´æ˜

### ğŸš€ ç¦»çº¿æ¨¡å¼ï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰

**ç‰¹ç‚¹ï¼š**
- ä½¿ç”¨ `markmap --offline` å‚æ•°
- æ‰€æœ‰CSSå’ŒJavaScriptèµ„æºå†…è”åˆ°HTMLæ–‡ä»¶ä¸­
- ç”Ÿæˆå®Œå…¨ç‹¬ç«‹çš„å•ä¸ªHTMLæ–‡ä»¶
- æ— éœ€å¤–éƒ¨ä¾èµ–ï¼Œå¯ç›´æ¥åˆ†å‘ä½¿ç”¨

**ä¼˜åŠ¿ï¼š**
- âœ… å•æ–‡ä»¶åˆ†å‘ï¼Œä¾¿äºå…±äº«
- âœ… å®Œå…¨ç¦»çº¿ä½¿ç”¨
- âœ… åŠ è½½é€Ÿåº¦å¿«ï¼ˆæ— ç½‘ç»œè¯·æ±‚ï¼‰
- âœ… æ–‡ä»¶è‡ªåŒ…å«ï¼Œä¸ä¾èµ–æœåŠ¡å™¨

**é€‚ç”¨åœºæ™¯ï¼š**
- æ–‡æ¡£åˆ†å‘å’Œå…±äº«
- ç¦»çº¿æ¼”ç¤º
- é‚®ä»¶é™„ä»¶
- å•ç‹¬ä½¿ç”¨çš„æ€ç»´å¯¼å›¾

### ğŸ“¦ æœ¬åœ°èµ„æºæ¨¡å¼ï¼ˆå¤‡ç”¨ï¼‰

**ç‰¹ç‚¹ï¼š**
- ä½¿ç”¨å…±äº«çš„ `libs` ç›®å½•å­˜å‚¨é™æ€èµ„æº
- HTMLæ–‡ä»¶å¼•ç”¨ç›¸å¯¹è·¯å¾„çš„å¤–éƒ¨èµ„æº
- æ”¯æŒåŠ¨æ€baseè·¯å¾„ï¼Œå…¼å®¹æ–‡ä»¶å’ŒHTTPè®¿é—®

**ä¼˜åŠ¿ï¼š**
- âœ… å¤šä¸ªHTMLæ–‡ä»¶å…±äº«èµ„æºï¼ŒèŠ‚çœç©ºé—´
- âœ… å¯è‡ªå®šä¹‰é™æ€èµ„æº
- âœ… æ”¯æŒnginxä»£ç†è®¿é—®
- âœ… ä¾¿äºæ‰¹é‡ç”Ÿæˆå’Œç®¡ç†

**é€‚ç”¨åœºæ™¯ï¼š**
- æœåŠ¡å™¨éƒ¨ç½²
- æ‰¹é‡ç”Ÿæˆå¤§é‡æ–‡ä»¶
- éœ€è¦è‡ªå®šä¹‰èµ„æºçš„åœºæ™¯

### æ¨¡å¼æ§åˆ¶

**ç¯å¢ƒå˜é‡ï¼š**
```bash
# é»˜è®¤å¯ç”¨ç¦»çº¿æ¨¡å¼
MARKMAP_OFFLINE=true

# ç¦ç”¨ç¦»çº¿æ¨¡å¼ï¼Œä½¿ç”¨æœ¬åœ°èµ„æº
MARKMAP_OFFLINE=false
```

**APIå‚æ•°ï¼š**
```json
{
  "markdown": "# å†…å®¹",
  "offline": true   // true=ç¦»çº¿æ¨¡å¼, false=æœ¬åœ°èµ„æºæ¨¡å¼
}
```

## é™æ€èµ„æºé…ç½®ï¼ˆæœ¬åœ°èµ„æºæ¨¡å¼ï¼‰

### è‡ªåŠ¨èµ„æºç®¡ç†

å½“ä½¿ç”¨æœ¬åœ°èµ„æºæ¨¡å¼æ—¶ï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨ç®¡ç†é™æ€èµ„æºï¼š
- é¦–æ¬¡ç”Ÿæˆæ—¶ï¼Œè‡ªåŠ¨å°† `src/libs/` ä¸‹çš„èµ„æºå¤åˆ¶åˆ° `output/markmap/html/libs/`
- æ‰€æœ‰ç”Ÿæˆçš„ HTML æ–‡ä»¶å…±äº«åŒä¸€ä¸ª `libs` ç›®å½•
- ç”Ÿæˆçš„ HTML æ–‡ä»¶ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé…åˆåŠ¨æ€baseæ ‡ç­¾æ”¯æŒå¤šç§è®¿é—®æ–¹å¼

### å¿…éœ€çš„é™æ€èµ„æºæ–‡ä»¶

åœ¨ `src/libs/` ç›®å½•ä¸‹éœ€è¦ä»¥ä¸‹æ–‡ä»¶ï¼š

| æ–‡ä»¶å | æ¥æº | ç”¨é€” |
|--------|------|------|
| `d3.min.js` | D3.js åº“ | æ•°æ®å¯è§†åŒ–æ ¸å¿ƒåº“ |
| `markmap-view.js` | Markmap è§†å›¾åº“ | æ€ç»´å¯¼å›¾æ¸²æŸ“ |
| `markmap-toolbar.js` | Markmap å·¥å…·æ  | äº¤äº’å·¥å…·æ  |
| `markmap-toolbar.css` | å·¥å…·æ æ ·å¼ | å·¥å…·æ æ ·å¼ |
| `highlightjs-default.css` | ä»£ç é«˜äº®æ ·å¼ | è¯­æ³•é«˜äº® |

### ä¸‹è½½é™æ€èµ„æº

å¦‚æœ `src/libs/` ç›®å½•ä¸‹ç¼ºå°‘èµ„æºæ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸‹è½½ï¼š

```bash
# è¿›å…¥ libs ç›®å½•
cd src/libs/

# ä¸‹è½½æ‰€éœ€èµ„æº
wget https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js -O d3.min.js
wget https://cdn.jsdelivr.net/npm/markmap-view@0.18.12/dist/browser/index.js -O markmap-view.js
wget https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/index.js -O markmap-toolbar.js
wget https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/style.css -O markmap-toolbar.css
wget https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css -O highlightjs-default.css
```

## Nginx é…ç½®

å¦‚æœä½¿ç”¨ Nginx ä»£ç†ï¼Œå»ºè®®ä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š

```nginx
# æ€ç»´å¯¼å›¾æ–‡ä»¶è®¿é—®
location /mind-html/ {
    alias /usr/share/nginx/html/output/markmap/html/;
    expires 1y;
    try_files $uri $uri/ =404;
}
```

**è·¯å¾„è¯´æ˜**ï¼š
- å®¿ä¸»æœºè·¯å¾„ï¼š`app/output/markmap/html/` ï¼ˆä¸markmap-serviceåŒçº§ï¼‰
- å®¹å™¨å†…è·¯å¾„ï¼š`/app/output/markmap/html/`
- Nginxè·¯å¾„ï¼š`/usr/share/nginx/html/output/markmap/html/` ï¼ˆé€šè¿‡å·æ˜ å°„ï¼‰

## æ–‡ä»¶ç»“æ„

```
app/
â”œâ”€â”€ markmap-service/      # é¡¹ç›®ä¸»ç›®å½•
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.js      # ä¸»æœåŠ¡æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ libs/         # é™æ€èµ„æºç›®å½•
â”‚   â”‚       â”œâ”€â”€ d3.min.js
â”‚   â”‚       â”œâ”€â”€ markmap-view.js
â”‚   â”‚       â”œâ”€â”€ markmap-toolbar.js
â”‚   â”‚       â”œâ”€â”€ markmap-toolbar.css
â”‚   â”‚       â””â”€â”€ highlightjs-default.css
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ README.md
â””â”€â”€ output/               # è¾“å‡ºç›®å½•ï¼ˆä¸markmap-serviceåŒçº§ï¼‰
    â””â”€â”€ markmap/
        â””â”€â”€ html/         # ç”Ÿæˆçš„HTMLæ–‡ä»¶
            â”œâ”€â”€ libs/     # å…±äº«é™æ€èµ„æº
            â”œâ”€â”€ markmap_xxx.html
            â””â”€â”€ markmap_yyy.html
```

## ç¯å¢ƒå˜é‡

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `PORT` | `3000` | æœåŠ¡ç«¯å£ |
| `HTML_DIR` | `/app/output/markmap/html` | HTMLè¾“å‡ºç›®å½•ï¼ˆå®¹å™¨å†…è·¯å¾„ï¼‰ |
| `LIBS_DIR` | `./src/libs` | é™æ€èµ„æºç›®å½•ï¼ˆç›¸å¯¹äºappç›®å½•ï¼‰ |

**æ³¨æ„**ï¼šåœ¨å®é™…éƒ¨ç½²ä¸­ï¼Œ`output` ç›®å½•ä¸ `markmap-service` ç›®å½•æ˜¯åŒçº§çš„ï¼ˆéƒ½åœ¨appç›®å½•ä¸‹ï¼‰ï¼Œå®¹å™¨é€šè¿‡å·æ˜ å°„å°†å®¿ä¸»æœºçš„ `app/output` ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ `/app/output`ã€‚

## æ•…éšœæ’é™¤

### 1. é™æ€èµ„æºåŠ è½½å¤±è´¥

**é—®é¢˜**ï¼šæµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º MIME ç±»å‹é”™è¯¯
```
Refused to apply style from '...' because its MIME type ('text/html') is not a supported stylesheet MIME type
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `src/libs/` ç›®å½•ä¸‹æ˜¯å¦æœ‰æ‰€éœ€çš„é™æ€èµ„æºæ–‡ä»¶
- ç¡®ä¿ Nginx é…ç½®æ­£ç¡®è®¾ç½®äº† MIME ç±»å‹
- é‡å¯æœåŠ¡ä»¥é‡æ–°å¤åˆ¶é™æ€èµ„æº

### 2. Docker æ„å»ºå¤±è´¥

**é—®é¢˜**ï¼šç½‘ç»œè¿æ¥é—®é¢˜å¯¼è‡´æ„å»ºå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ä½¿ç”¨å›½å†… Docker é•œåƒæº
- é‡è¯•æ„å»ºå‘½ä»¤

### 3. ç”Ÿæˆçš„ HTML æ–‡ä»¶æ— æ³•æ­£å¸¸æ˜¾ç¤º

**é—®é¢˜**ï¼šæ€ç»´å¯¼å›¾ä¸æ˜¾ç¤ºæˆ–åŠŸèƒ½å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥é™æ€èµ„æºæ–‡ä»¶æ˜¯å¦å®Œæ•´
- ç¡®ä¿ HTML æ–‡ä»¶å’Œ libs ç›®å½•åœ¨åŒä¸€å±‚çº§
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

## å¼€å‘è¯´æ˜

### æŠ€æœ¯æ ˆ

- **åç«¯**ï¼šNode.js + Express.js
- **æ€ç»´å¯¼å›¾**ï¼šmarkmap-cli
- **å®¹å™¨åŒ–**ï¼šDocker + Docker Compose
- **æ–‡ä»¶å¤„ç†**ï¼šmulter

### æ ¸å¿ƒé€»è¾‘

1. æ¥æ”¶ Markdown å†…å®¹ï¼ˆJSON æˆ–æ–‡ä»¶ä¸Šä¼ ï¼‰
2. ä½¿ç”¨ markmap-cli ç”ŸæˆåŸºç¡€ HTML
3. æ›¿æ¢ CDN èµ„æºé“¾æ¥ä¸ºæœ¬åœ°è·¯å¾„
4. å¤åˆ¶é™æ€èµ„æºåˆ°å…±äº«ç›®å½•ï¼ˆé¦–æ¬¡ï¼‰
5. è¿”å›ç”Ÿæˆçš„ HTML æ–‡ä»¶è·¯å¾„

## è®¸å¯è¯

[MIT License](LICENSE)

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼